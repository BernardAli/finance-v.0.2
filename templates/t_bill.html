{% extends 'base.html' %}
{% load static %}
{% load humanize %}


{% block title %} Treasury Bill {% endblock %}

{% block content %}

<!-- Begin Page Content -->
<div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Treasury Bill Rate</h1>
                        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
                    </div>

                    <!-- Content Row -->
                    <div class="row">
                        <div class="col-xl-12 col-lg-7">
                            <div class="card shadow mb-4">
                                <div class="card-body text text-center">
                                    <div class="row">
                                              <div class="col-lg-2">
                                                <div class="nav flex-column nav-pills" id="v-statements" role="tablist" aria-orientation="vertical">
                                                  <button class="nav-link active" id="v-qtr-tab" data-toggle="pill" data-target="#v-qtr" type="button" role="tab" aria-controls="v-qtr" aria-selected="true">91 DAY BILL</button>
                                                    <br>
                                                  <button class="nav-link" id="v-half-tab" data-toggle="pill" data-target="#v-half" type="button" role="tab" aria-controls="v-half" aria-selected="false">182 DAY BILL</button>
                                                </div>
                                              </div>
                                              <div class="col-lg-2">
                                                <div class="tab-content" id="v-statementsContent">
                                                  <div class="tab-pane fade show active" id="v-qtr" role="tabpanel" aria-labelledby="v-qtr-tab">
                                                      <button id="one_month" type="button">1M</button>
                                                        <button id="six_months" type="button">6M</button>
                                                        <button id="one_year" type="button">1Y</button>
                                                        <button id="ytd" type="button">YTD</button>
                                                        <button id="all" type="button">ALL</button>
                                                        <div id="chart"></div>


                                                      <script>
                                                        const latest_trading_day = '{{share_price_latest.issue_date}}';

                                                        const one_month = '{{one_month}}';


                                                        const six_month = '{{six_month}}';


                                                        const one_year = '{{one_year}}';

                                                        const share_price_first = '{{share_price_first}}';

                                                        const dates = [{% for price in three_months %} Date.parse('{{price.issue_date}}'),{% endfor %}]


                                                        const prices = [{% for price in three_months %} {{price.interest}}, {% endfor %}]

                                                        var data = dates.map(function(e, i){
                                                            return [e, prices[i]];
                                                        });

                                                        const series = {
                                                            "dataSeries": {
                                                              "dates": [{% for value in three_months %} '{{value.issue_date|date:"D M, Y" }}', {% endfor %}],
                                                              "prices": [{% for value in three_months %} {{value.interest}}, {% endfor %}]
                                                            }
                                                          }

                                                          var options = {
                                                          series: [{
                                                          name: "Share Price",
                                                          data: data
                                                        }],
                                                          chart: {
                                                          id: 'area-datetime',
                                                          type: 'area',
                                                          height: 350,
                                                          width: 950,
                                                          zoom: {
                                                            autoScaleYaxis: true
                                                          }
                                                        },
                                                        annotations: {
                                                          yaxis: [{
                                                            y: 30,
                                                            borderColor: '#999',
                                                            label: {
                                                              show: true,
                                                              style: {
                                                                color: "#fff",
                                                                background: '#00E396'
                                                              }
                                                            }
                                                          }],
                                                          xaxis: [{
                                                            x: new Date('{{share_price_first}}').getTime(),
                                                            borderColor: '#999',
                                                            yAxisIndex: 0,
                                                            label: {
                                                              show: true,
                                                              style: {
                                                                color: "#fff",
                                                                background: '#775DD0'
                                                              }
                                                            }
                                                          }]
                                                        },
                                                        dataLabels: {
                                                          enabled: false
                                                        },
                                                        markers: {
                                                          size: 0,
                                                          style: 'hollow',
                                                        },
                                                        xaxis: {
                                                          type: 'datetime',
                                                          min: new Date('{{share_price_first}}').getTime(),
                                                          tickAmount: 6,
                                                        },
                                                        tooltip: {
                                                          x: {
                                                            format: 'dd MMM yyyy',
                                                          }
                                                        },
                                                        fill: {
                                                          type: 'gradient',
                                                          gradient: {
                                                            shadeIntensity: 1,
                                                            opacityFrom: 0.7,
                                                            opacityTo: 0.9,
                                                            stops: [0, 100]
                                                          }
                                                        },
                                                        };

                                                        var chart = new ApexCharts(document.querySelector("#chart"), options);
                                                        chart.render();

                                                        var resetCssClasses = function(activeEl) {
                                                            var els = document.querySelectorAll('button')
                                                            Array.prototype.forEach.call(els, function(el) {
                                                              el.classList.remove('active')
                                                            })

                                                            activeEl.target.classList.add('active')
                                                          }

                                                          document.querySelector('#one_month').addEventListener('click', function(e) {
                                                              resetCssClasses(e)

                                                              chart.zoomX(
                                                                new Date(one_month).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#six_months').addEventListener('click', function(e) {
                                                              resetCssClasses(e)

                                                              chart.zoomX(
                                                                new Date(six_month).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#one_year').addEventListener('click', function(e) {
                                                              resetCssClasses(e)
                                                              chart.zoomX(
                                                                new Date(one_year).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#ytd').addEventListener('click', function(e) {
                                                            resetCssClasses(e)

                                                            chart.zoomX(
                                                              new Date('2023-01-01').getTime(),
                                                              new Date(latest_trading_day).getTime()
                                                            )
                                                          })

                                                          document.querySelector('#all').addEventListener('click', function(e) {
                                                            resetCssClasses(e)

                                                            chart.zoomX(
                                                              new Date(share_price_first).getTime(),
                                                              new Date().getTime(),
                                                            )
                                                          });
                                                      </script>
                                                        <!-- End Area Chart -->
                                                  </div>
                                                  <div class="tab-pane fade show" id="v-half" role="tabpanel" aria-labelledby="v-half-tab">
                                                      <button id="nine_one_month" type="button">1M</button>
                                                        <button id="nine_six_months" type="button">6M</button>
                                                        <button id="nine_one_year" type="button">1Y</button>
                                                        <button id="nine_ytd" type="button">YTD</button>
                                                        <button id="nine_all" type="button">ALL</button>
                                                        <div id="ninechart"></div>


                                                      <script>
                                                        const nine_latest_trading_day = '{{share_price_latest.issue_date}}';

                                                        const nine_one_month = '{{nine_one_month}}';


                                                        const nine_six_month = '{{nine_six_month}}';


                                                        const nine_one_year = '{{nine_one_year}}';

                                                        const nine_share_price_first = '{{share_price_first}}';

                                                        const nine_dates = [{% for price in six_months %} Date.parse('{{price.issue_date}}'),{% endfor %}]


                                                        const nine_prices = [{% for price in six_months %} {{price.interest}}, {% endfor %}]

                                                        var data = nine_dates.map(function(e, i){
                                                            return [e, nine_prices[i]];
                                                        });

                                                        const nine_series = {
                                                            "dataSeries": {
                                                              "dates": [{% for value in six_months %} '{{value.issue_date|date:"D M, Y" }}', {% endfor %}],
                                                              "prices": [{% for value in six_months %} {{value.interest}}, {% endfor %}]
                                                            }
                                                          }

                                                          var options = {
                                                          series: [{
                                                          name: "Share Price",
                                                          data: data
                                                        }],
                                                          chart: {
                                                          id: 'area-datetime',
                                                          type: 'area',
                                                          height: 350,
                                                          width: 950,
                                                          zoom: {
                                                            autoScaleYaxis: true
                                                          }
                                                        },
                                                        annotations: {
                                                          yaxis: [{
                                                            y: 30,
                                                            borderColor: '#999',
                                                            label: {
                                                              show: true,
                                                              style: {
                                                                color: "#fff",
                                                                background: '#00E396'
                                                              }
                                                            }
                                                          }],
                                                          xaxis: [{
                                                            x: new Date('{{share_price_first}}').getTime(),
                                                            borderColor: '#999',
                                                            yAxisIndex: 0,
                                                            label: {
                                                              show: true,
                                                              style: {
                                                                color: "#fff",
                                                                background: '#775DD0'
                                                              }
                                                            }
                                                          }]
                                                        },
                                                        dataLabels: {
                                                          enabled: false
                                                        },
                                                        markers: {
                                                          size: 0,
                                                          style: 'hollow',
                                                        },
                                                        xaxis: {
                                                          type: 'datetime',
                                                          min: new Date('{{share_price_first}}').getTime(),
                                                          tickAmount: 6,
                                                        },
                                                        tooltip: {
                                                          x: {
                                                            format: 'dd MMM yyyy',
                                                          }
                                                        },
                                                        fill: {
                                                          type: 'gradient',
                                                          gradient: {
                                                            shadeIntensity: 1,
                                                            opacityFrom: 0.7,
                                                            opacityTo: 0.9,
                                                            stops: [0, 100]
                                                          }
                                                        },
                                                        };

                                                        var chart1 = new ApexCharts(document.querySelector("#ninechart"), options);
                                                        chart1.render();

                                                        var resetCssClasses = function(activeEl) {
                                                            var els = document.querySelectorAll('button')
                                                            Array.prototype.forEach.call(els, function(el) {
                                                              el.classList.remove('active')
                                                            })

                                                            activeEl.target.classList.add('active')
                                                          }

                                                          document.querySelector('#nine_one_month').addEventListener('click', function(e) {
                                                              resetCssClasses(e)

                                                              chart1.zoomX(
                                                                new Date(nine_one_month).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#nine_six_months').addEventListener('click', function(e) {
                                                              resetCssClasses(e)

                                                              chart1.zoomX(
                                                                new Date(nine_six_month).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#nine_one_year').addEventListener('click', function(e) {
                                                              resetCssClasses(e)
                                                              chart1.zoomX(
                                                                new Date(nine_one_year).getTime(),
                                                                new Date(nine_latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#nine_ytd').addEventListener('click', function(e) {
                                                            resetCssClasses(e)

                                                            chart1.zoomX(
                                                              new Date('2023-01-01').getTime(),
                                                              new Date(nine_latest_trading_day).getTime()
                                                            )
                                                          })

                                                          document.querySelector('#nine_all').addEventListener('click', function(e) {
                                                            resetCssClasses(e)

                                                            chart1.zoomX(
                                                              new Date(share_price_first).getTime(),
                                                              new Date().getTime(),
                                                            )
                                                          });
                                                      </script>
                                                        <!-- End Area Chart -->
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-lg-7">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <div class="table-responsive" style="width:80%; margin: 0 auto; padding-right: 2rem">
                                        <table class="table table-striped table-bordered table-hover" id="dataTable" width="60%" cellspacing="0">
                                            <thead>
                                                <tr>
                                                    <th>Issue Date</th>
                                                    <th>Tender</th>
                                                    <th>Security</th>
                                                    <th>discount</th>
                                                    <th>interest</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
                                                    <th>Issue Date</th>
                                                    <th>Tender</th>
                                                    <th>Security</th>
                                                    <th>discount</th>
                                                    <th>interest</th>
                                                </tr>
                                            </tfoot>
                                            <tbody>
                                            {% for rate in t_bill %}
                                                <tr>
                                                    <td>{{ rate.issue_date }}</td>
                                                    <td>{{ rate.tender }}</td>
                                                    <td>{{ rate.security.security }}</td>
                                                    <td>{{ rate.discount }}</td>
                                                    <td>{{ rate.interest }}</td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>



                </div>
<!-- /.container-fluid -->

{% endblock %}

{% block script %}
<!-- Page level plugins -->
    <script src="{% static 'vendor/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'vendor/datatables/dataTables.bootstrap4.min.js' %}"></script>

    <!-- Page level custom scripts -->
    <script src="{% static 'js/demo/datatables-demo.js' %}"></script>
{% endblock %}