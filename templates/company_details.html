{% extends 'base.html' %}
{% load mathfilters %}
{% load humanize %}
{% load static %}

{% block title %} {{ company.company_id }}  {% endblock %}

{% block content %}

<!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">{{ company.name }} ({{ company.country.code }}-{{ company.company_id }})</h1>

                        {% if price_year_start.price >= 0 %}
                        <p>
                            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-sm pl-3 pr-3">Sell</a>
                            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm pl-3 pr-3">Buy</a>
                        </p>

                        <p>
                            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-info shadow-sm"><i
                                class="fas fa-bell fa-sm text-white-50"></i>
                            </a>
                            <a href="{% url 'company_file' company.id %}" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                class="fas fa-download fa-sm text-white-50"></i> Latest Report
                            </a>
                            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                class="fas fa-star fa-sm text-white-50"></i> Add to WatchList
                            </a>
                        </p>
                        {% else %}
                        <p>
                            <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-sm">
                                {{company.market.all.first}}
                            </a>
                        </p>

                        {% endif %}

                    </div>

                   <div class="row">

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-12 col-md-12 mb-6">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">{{ company.isin }}</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                {{ company.name }}
                                            </div>
                                            {% if price_year_start.price >= 0 %}
                                            <div class="h6 mb-0 font-weight-light text-gray-800">
                                                <strong>{{ company.country.currency_code }} {{ price.price }}
                                                    <small>
                                                        {% if price.price|sub:previous_close.price|div:previous_close.price >= 0 %}
                                                            {% if price.price|sub:previous_close.price|div:previous_close.price > 0 %}
                                                                <span style="font-weight: bold; color: green"><i class="bx bxs-up-arrow-alt"></i>({{price.price|sub:previous_close.price|div:previous_close.price|mul:100|floatformat:2 }}%)</span>
                                                            {% else %}
                                                                <span style="font-weight: bold; color: blue"><i class="bx bxs-right-arrow-alt"></i>({{price.price|sub:previous_close.price|div:previous_close.price|mul:100|floatformat:2 }}%)</span>
                                                            {% endif %}
                                                        {% else %}
                                                            <span style="font-weight: bold; color: red"><i class="bx bxs-down-arrow-alt"></i>({{price.price|sub:previous_close.price|div:previous_close.price|mul:100|floatformat:2 }}%)</span>
                                                        {% endif %}
                                                    </small>
                                                </strong>
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-auto">
                                            <img src="{{ company.logo.url }}" alt="" height="100">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row mt-4">

                        <div class="col-lg-8">

                            <!-- Default Card Example -->
                            <div class="card mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">{{ company.name }} Summary</h6>
                                </div>
                                <div class="card-body text text-center">
                                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                                      <li class="nav-item">
                                        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Profile</a>
                                      </li>
                                        {% if price_year_start.price >= 0 %}
                                      <li class="nav-item">
                                        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Financial Summary</a>
                                      </li>
                                        {% endif %}
                                      <li class="nav-item">
                                        <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Charts</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="technical-tab" data-toggle="tab" href="#technical" role="tab" aria-controls="contact" aria-selected="false">Technical</a>
                                      </li>
                                        </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="analysis-tab" data-toggle="tab" href="#analysis" role="tab" aria-controls="contact" aria-selected="false">Analysis</a>
                                      </li>
                                        {% if price_year_start.price >= 0 %}
                                        </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="ownership-tab" data-toggle="tab" href="#ownership" role="tab" aria-controls="contact" aria-selected="false">Ownership</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="split-tab" data-toggle="tab" href="#split" role="tab" aria-controls="contact" aria-selected="false">Dividends / Share Splits</a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                    <div class="tab-content" id="myTabContent">
                                      <div class="tab-pane fade show active pt-3" id="home" role="tabpanel" aria-labelledby="home-tab">
                                        <p>{{ company.summary }}</p>
                                      </div>
                                      <div class="tab-pane fade pt-3" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                          <!-- <p>Financials Here</p> -->
                                          {% if statement %}
                                          <p>Financial Statements for {{statement.file.year}}</p>
                                          <div class="row">
                                            <div class="col-3">
                                              <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                                <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">Income Statement</a>
                                                <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="false">Balance Sheet</a>
                                                <a class="nav-link" id="v-pills-messages-tab" data-toggle="pill" href="#v-pills-messages" role="tab" aria-controls="v-pills-messages" aria-selected="false">Cash Flow</a>
                                                <a class="nav-link" id="v-pills-settings-tab" data-toggle="pill" href="#v-pills-settings" role="tab" aria-controls="v-pills-settings" aria-selected="false">Profitability</a>
                                                <a class="nav-link" id="v-pills-valuation-tab" data-toggle="pill" href="#v-pills-valuation" role="tab" aria-controls="v-pills-valuation" aria-selected="false">Valuations</a>
                                              </div>
                                            </div>
                                            <div class="col-9">
                                              <div class="tab-content" id="v-pills-tabContent">
                                                <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                                                    <table class="table table-striped table-bordered table-hover">
                                                        <tr>
                                                            <th></th>
                                                            <th>{{company.country.currency_code}}</th>
                                                        </tr>
                                                        <tr>
                                                            <td>Revenue (million)</td>
                                                            <td class="value">{{statement.total_operating_revenue|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Revenue Per Share</td>
                                                            <td class="value">{% for detail in share %}{{ statement.total_operating_revenue|div:detail.issued_shares|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Revenue Growth (%)</td>
                                                            <td class="value">{{statement.total_operating_revenue|sub:previous_revenue.total_operating_revenue|div:previous_revenue.total_operating_revenue|mul:100|floatformat:2}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Gross Profit (million)</td>
                                                            <td class="value">{{statement.gross_profit_ebitda|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Net Income (million)</td>
                                                            <td class="value">{{statement.net_profit_loss|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Diluted EPS</td>
                                                            <td class="value">{% for detail in share %}{{ statement.net_profit_loss|div:detail.issued_shares|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Earning Growth  (%)</td>
                                                            <td class="value">{{statement.net_profit_loss|sub:previous_revenue.net_profit_loss|div:previous_revenue.net_profit_loss|mul:100|floatformat:2}}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                                                    <table class="table table-striped table-bordered table-hover">
                                                        <tr>
                                                            <th></th>
                                                            <th>{{company.country.currency_code}}</th>
                                                        </tr>
                                                        <tr>
                                                            <td>Total Cash (million)</td>
                                                            <td class="value">{{statement.total_cash|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Total Cash Per Share</td>
                                                            <td class="value">{% for detail in share %}{{ statement.total_cash|div:detail.issued_shares|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Total Debt (million)</td>
                                                            <td class="value">{{statement.total_liability|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Total Debt/ Equity</td>
                                                            <td class="value">{{statement.total_liability|div:statement.total_equity|floatformat:2}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Current Ratio</td>
                                                            <td class="value">{{statement.current_asset|div:statement.current_liability|floatformat:2}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Book Value Per Share</td>
                                                            <td class="value">{% for detail in share %}{{ statement.total_equity|div:detail.issued_shares|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                                                    <table class="table table-striped table-bordered table-hover">
                                                        <tr>
                                                            <th></th>
                                                            <th>{{company.country.currency_code}}</th>
                                                        </tr>
                                                        <tr>
                                                            <td>Operating Cash Flow (million)</td>
                                                            <td class="value">{{statement.operating_cash_flow|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Levered Free Cash Flow (million)</td>
                                                            <td class="value">{{statement.operating_cash_flow|add:statement.investing_cash_flow|div:1000000|floatformat:2|intcomma}}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                                                    <table class="table table-striped table-bordered table-hover">
                                                        <tr>
                                                            <th></th>
                                                            <th>%</th>
                                                        </tr>
                                                        <tr>
                                                            <td>Profit Margin</td>
                                                            <td class="value">{{statement.net_profit_loss|div:statement.total_operating_revenue|floatformat:2}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Operating Margin</td>
                                                            <td class="value">{{statement.operating_profit_ebit|div:statement.total_operating_revenue|floatformat:2}}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="tab-pane fade" id="v-pills-valuation" role="tabpanel" aria-labelledby="v-pills-valuation-tab">
                                                    <table class="table table-striped table-bordered table-hover">
                                                        <tr>
                                                            <th></th>
                                                            <th>{{company.country.currency_code}}</th>
                                                        </tr>
                                                        <tr>
                                                            <td>Market Cap (million)</td>
                                                            <td>{{ company.country.currency_code }} {% for detail in share %}{{ detail.issued_shares|mul:price.price|div:1000000|floatformat:2|intcomma }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Enterprise Value (million)</td>
                                                            <td class="value">{{ company.country.currency_code }} {% for detail in share %}{{ detail.issued_shares|mul:price.price|sub:statement.total_cash|div:1000000|floatformat:2|intcomma  }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Trailing P/E </td>
                                                            <td class="value">{% for detail in share %} {{ statement.net_profit_loss|div:detail.issued_shares|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Price/Sales</td>
                                                            <td class="value">{% for detail in share %}{{ detail.issued_shares|mul:price.price|div:statement.total_operating_revenue|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Price/Book</td>
                                                            <td class="value">{% for detail in share %}{{ detail.issued_shares|mul:price.price|div:statement.total_equity|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Enterprise Value/ Revenue</td>
                                                            <td class="value">{% for detail in share %}{{ detail.issued_shares|mul:price.price|sub:statement.total_cash|div:statement.total_operating_revenue|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Enterprise Value/ EBITDA</td>
                                                            <td class="value">{% for detail in share %}{{ detail.issued_shares|mul:price.price|sub:statement.total_cash|div:statement.gross_profit_ebitda|floatformat:2 }}{% endfor %}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        {% else %}
                                            <p>No statement added yet</p>
                                        {% endif %}

                                      </div>
                                      <div class="tab-pane fade pt-3" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                        <div class="row">
                                              <div class="col-2">
                                                <div class="nav flex-column nav-pills" id="v-charts" role="tablist" aria-orientation="vertical">
                                                  <button class="nav-link active" id="v-chart-tab" data-toggle="pill" data-target="#v-chart" type="button" role="tab" aria-controls="v-chart" aria-selected="true">Share Price</button>
                                                    <br>
                                                  <button class="nav-link" id="v-candle-tab" data-toggle="pill" data-target="#v-candle" type="button" role="tab" aria-controls="v-candle" aria-selected="false">Candle Sticks</button>
                                                    <br>
                                                  <button class="nav-link" id="v-profit-tab" data-toggle="pill" data-target="#v-profit" type="button" role="tab" aria-controls="v-profit" aria-selected="false">Fin. Statement</button>
                                                    <br>
                                                  <button class="nav-link" id="v-radar-tab" data-toggle="pill" data-target="#v-radar" type="button" role="tab" aria-controls="v-radar" aria-selected="false">Stmt Radar</button>
                                                </div>
                                              </div>
                                              <div class="col-10">
                                                <div class="tab-content" id="v-chartsContent">
                                                  <div class="tab-pane fade show active" id="v-chart" role="tabpanel" aria-labelledby="v-chart-tab">
                                                        <div>
                                                            <button id="one_month" type="button">1M</button>
                                                            <button id="six_months" type="button">6M</button>
                                                            <button id="one_year" type="button">1Y</button>
                                                            <button id="ytd" type="button">YTD</button>
                                                            <button id="all" type="button">ALL</button>
                                                        </div>
                                                        <p class="value pt-2" id="month-value"></p>
                                                        <div id="price_chart"></div>

                                                      <script>
                                                        const latest_trading_day = '{{share_price_latest.date}}';

                                                        const one_month = '{{one_month}}';


                                                        const six_month = '{{six_month}}';


                                                        const one_year = '{{one_year}}';

                                                        const share_price_first = '{{share_price_first}}';

                                                        const dates = [{% for price in share_price %} Date.parse('{{price.date}}'),{% endfor %}]


                                                        const prices = [{% for price in share_price %} {{price.price}}, {% endfor %}]

                                                        var data = dates.map(function(e, i){
                                                            return [e, prices[i]];
                                                        });

                                                        const series = {
                                                            "dataSeries": {
                                                              "dates": [{% for price in share_price %} '{{price.date|date:"D M, Y" }}', {% endfor %}],
                                                              "prices": [{% for price in share_price %} {{price.price}}, {% endfor %}]
                                                            }
                                                          }

                                                          var options = {
                                                          series: [{
                                                          name: "Share Price",
                                                          data: data
                                                        }],
                                                          chart: {
                                                          id: 'area-datetime',
                                                          type: 'area',
                                                          height: 350,
                                                          zoom: {
                                                            autoScaleYaxis: true
                                                          }
                                                        },
                                                        annotations: {
                                                          yaxis: [{
                                                            y: 30,
                                                            borderColor: '#999',
                                                            label: {
                                                              show: true,
                                                              style: {
                                                                color: "#fff",
                                                                background: '#00E396'
                                                              }
                                                            }
                                                          }],
                                                          xaxis: [{
                                                            x: new Date('{{share_price_first}}').getTime(),
                                                            borderColor: '#999',
                                                            yAxisIndex: 0,
                                                            label: {
                                                              show: true,
                                                              style: {
                                                                color: "#fff",
                                                                background: '#775DD0'
                                                              }
                                                            }
                                                          }]
                                                        },
                                                        dataLabels: {
                                                          enabled: false
                                                        },
                                                        markers: {
                                                          size: 0,
                                                          style: 'hollow',
                                                        },
                                                        xaxis: {
                                                          type: 'datetime',
                                                          min: new Date('{{share_price_first}}').getTime(),
                                                          tickAmount: 6,
                                                        },
                                                        tooltip: {
                                                          x: {
                                                            format: 'dd MMM yyyy',
                                                          }
                                                        },
                                                        fill: {
                                                          type: 'gradient',
                                                          gradient: {
                                                            shadeIntensity: 1,
                                                            opacityFrom: 0.7,
                                                            opacityTo: 0.9,
                                                            stops: [0, 100]
                                                          }
                                                        },
                                                        };

                                                        var price_chart = new ApexCharts(document.querySelector("#price_chart"), options);
                                                        price_chart.render();

                                                        var resetCssClasses = function(activeEl) {
                                                            var els = document.querySelectorAll('button')
                                                            Array.prototype.forEach.call(els, function(el) {
                                                              el.classList.remove('active')
                                                            })

                                                            activeEl.target.classList.add('active')
                                                          }

                                                          document.querySelector('#one_month').addEventListener('click', function(e) {
                                                              resetCssClasses(e)

                                                              price_chart.zoomX(
                                                                new Date(one_month).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )

                                                            })


                                                          document.querySelector('#six_months').addEventListener('click', function(e) {
                                                              resetCssClasses(e)

                                                              price_chart.zoomX(
                                                                new Date(six_month).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#one_year').addEventListener('click', function(e) {
                                                              resetCssClasses(e)
                                                              price_chart.zoomX(
                                                                new Date(one_year).getTime(),
                                                                new Date(latest_trading_day).getTime()
                                                              )
                                                            })

                                                          document.querySelector('#ytd').addEventListener('click', function(e) {
                                                            resetCssClasses(e)

                                                            price_chart.zoomX(
                                                              new Date('2023-01-01').getTime(),
                                                              new Date(latest_trading_day).getTime()
                                                            )
                                                          })

                                                          document.querySelector('#all').addEventListener('click', function(e) {
                                                            resetCssClasses(e)

                                                            price_chart.zoomX(
                                                              new Date(share_price_first).getTime(),
                                                              new Date().getTime(),
                                                            )
                                                          });
                                                      </script>
                                                        <!-- End Area Chart -->
                                                  </div>
                                                  <div class="tab-pane fade" id="v-candle" role="tabpanel" aria-labelledby="v-candle-tab">
                                                        <div id="main" style="width: 850px; height:400px;"></div>
                                                        <script type="text/javascript">
                                                        const date = [{% for price in share_price %} '{{price.date}}',{% endfor %}]


                                                        const price = [{% for price in share_price %} {{price.price}}, {% endfor %}]

                                                        const open = [{% for price in open_price %} {{price.price}}, {% endfor %}]

                                                        data = date.map(function(e, i){
                                                            return [e, open[i], price[i], price[i], price[i]];
                                                        });

                                                        const eg =  ['2013/1/24', 2320.26, 2320.26, 2287.3, 2362.94];

                                                          // Initialize the echarts instance based on the prepared dom
                                                          var myChart = echarts.init(document.getElementById('main'));

                                                          // Specify the configuration items and data for the chart
                                                          const upColor = '#ec0000';
                                                            const upBorderColor = '#8A0000';
                                                            const downColor = '#00da3c';
                                                            const downBorderColor = '#008F28';
                                                            // Each item: open，close，lowest，highest
                                                            const data0 = splitData(
                                                            data
                                                            );
                                                            function splitData(rawData) {
                                                              const categoryData = [];
                                                              const values = [];
                                                              for (var i = 0; i < rawData.length; i++) {
                                                                categoryData.push(rawData[i].splice(0, 1)[0]);
                                                                values.push(rawData[i]);
                                                              }
                                                              return {
                                                                categoryData: categoryData,
                                                                values: values
                                                              };
                                                            }
                                                            function calculateMA(dayCount) {
                                                              var result = [];
                                                              for (var i = 0, len = data0.values.length; i < len; i++) {
                                                                if (i < dayCount) {
                                                                  result.push('-');
                                                                  continue;
                                                                }
                                                                var sum = 0;
                                                                for (var j = 0; j < dayCount; j++) {
                                                                  sum += +data0.values[i - j][1];
                                                                }
                                                                result.push(sum / dayCount);
                                                              }
                                                              return result;
                                                            }
                                                            option = {
                                                              title: {
                                                                text: '',
                                                                left: 0
                                                              },
                                                              tooltip: {
                                                                trigger: 'axis',
                                                                axisPointer: {
                                                                  type: 'cross'
                                                                }
                                                              },
                                                              legend: {
                                                                data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30']
                                                              },
                                                              grid: {
                                                                left: '10%',
                                                                right: '10%',
                                                                bottom: '15%'
                                                              },
                                                              xAxis: {
                                                                type: 'category',
                                                                data: data0.categoryData,
                                                                boundaryGap: false,
                                                                axisLine: { onZero: false },
                                                                splitLine: { show: false },
                                                                min: 'dataMin',
                                                                max: 'dataMax'
                                                              },
                                                              yAxis: {
                                                                scale: true,
                                                                splitArea: {
                                                                  show: true
                                                                }
                                                              },
                                                              dataZoom: [
                                                                {
                                                                  type: 'inside',
                                                                  start: 50,
                                                                  end: 100
                                                                },
                                                                {
                                                                  show: true,
                                                                  type: 'slider',
                                                                  top: '90%',
                                                                  start: 50,
                                                                  end: 100
                                                                }
                                                              ],
                                                              series: [
                                                                {
                                                                  name: 'Candle',
                                                                  type: 'candlestick',
                                                                  data: data0.values,
                                                                  itemStyle: {
                                                                    color: upColor,
                                                                    color0: downColor,
                                                                    borderColor: upBorderColor,
                                                                    borderColor0: downBorderColor
                                                                  },
                                                                  markPoint: {
                                                                    label: {
                                                                      formatter: function (param) {
                                                                        return param != null ? Math.round(param.value) + '' : '';
                                                                      }
                                                                    },
                                                                    data: [
                                                                    ],
                                                                    tooltip: {
                                                                      formatter: function (param) {
                                                                        return param.name + '<br>' + (param.data.coord || '');
                                                                      }
                                                                    }
                                                                  },
                                                                  markLine: {
                                                                    symbol: ['none', 'none'],
                                                                    data: [
                                                                      [
                                                                        {
                                                                          emphasis: {
                                                                            label: {
                                                                              show: false
                                                                            }
                                                                          }
                                                                        },
                                                                        {
                                                                          type: 'max',
                                                                          valueDim: 'highest',
                                                                          symbol: 'circle',
                                                                          symbolSize: 10,
                                                                          label: {
                                                                            show: false
                                                                          },
                                                                          emphasis: {
                                                                            label: {
                                                                              show: false
                                                                            }
                                                                          }
                                                                        }
                                                                      ],
                                                                      {
                                                                        name: 'min line on close',
                                                                        type: 'min',
                                                                        valueDim: 'close'
                                                                      },
                                                                      {
                                                                        name: 'max line on close',
                                                                        type: 'max',
                                                                        valueDim: 'close'
                                                                      }
                                                                    ]
                                                                  }
                                                                },
                                                                {
                                                                  name: 'MA10',
                                                                  type: 'line',
                                                                  data: calculateMA(10),
                                                                  smooth: true,
                                                                  lineStyle: {
                                                                    opacity: 0.5
                                                                  }
                                                                },
                                                                {
                                                                  name: 'MA20',
                                                                  type: 'line',
                                                                  data: calculateMA(20),
                                                                  smooth: true,
                                                                  lineStyle: {
                                                                    opacity: 0.5
                                                                  }
                                                                },
                                                                {
                                                                  name: 'MA30',
                                                                  type: 'line',
                                                                  data: calculateMA(30),
                                                                  smooth: true,
                                                                  lineStyle: {
                                                                    opacity: 0.5
                                                                  }
                                                                }
                                                              ]
                                                            };

                                                          // Display the chart using the configuration items and data just specified.
                                                          myChart.setOption(option);
                                                        </script>
                                                  </div>
                                                    <div class="tab-pane fade" id="v-profit" role="tabpanel" aria-labelledby="v-profit-tab">
                                                      <div id="statementChart"></div>
                                                        <script>
                                                            var options = {
                                                              series: [{
                                                              name: 'Income',
                                                              type: 'column',
                                                              data: [{% for report in statements %} {{report.net_profit_loss|div:1000000}}, {% endfor %}]
                                                            }, {
                                                              name: 'Cashflow',
                                                              type: 'column',
                                                              data: [{% for report in statements %} {{report.operating_cash_flow|div:1000000}}, {% endfor %}]
                                                            }, {
                                                              name: 'Revenue',
                                                              type: 'line',
                                                              data: [{% for report in statements %} {{report.total_operating_revenue|div:1000000}}, {% endfor %}]
                                                            }],
                                                              chart: {
                                                              height: 350,
                                                              type: 'line',
                                                              stacked: false
                                                            },
                                                            dataLabels: {
                                                              enabled: false
                                                            },
                                                            stroke: {
                                                              width: [1, 1, 4]
                                                            },
                                                            title: {
                                                              text: '{{ company.name }} - Financial Statement Summary',
                                                              align: 'left',
                                                              offsetX: 110
                                                            },
                                                            xaxis: {
                                                              categories: [{% for report in statements %} {{report.file.year|date:"Y"}}, {% endfor %}],
                                                            },
                                                            yaxis: [
                                                              {
                                                                axisTicks: {
                                                                  show: true,
                                                                },
                                                                axisBorder: {
                                                                  show: true,
                                                                  color: '#008FFB'
                                                                },
                                                                labels: {
                                                                  style: {
                                                                    colors: '#008FFB',
                                                                  }
                                                                },
                                                                title: {
                                                                  text: "Income (million)",
                                                                  style: {
                                                                    color: '#008FFB',
                                                                  }
                                                                },
                                                                tooltip: {
                                                                  enabled: true
                                                                }
                                                              },
                                                              {
                                                                seriesName: 'Income',
                                                                opposite: true,
                                                                axisTicks: {
                                                                  show: true,
                                                                },
                                                                axisBorder: {
                                                                  show: true,
                                                                  color: '#00E396'
                                                                },
                                                                labels: {
                                                                  style: {
                                                                    colors: '#00E396',
                                                                  }
                                                                },
                                                                title: {
                                                                  text: "Operating Cashflow (million)",
                                                                  style: {
                                                                    color: '#00E396',
                                                                  }
                                                                },
                                                              },
                                                              {
                                                                seriesName: 'Revenue',
                                                                opposite: true,
                                                                axisTicks: {
                                                                  show: true,
                                                                },
                                                                axisBorder: {
                                                                  show: true,
                                                                  color: '#FEB019'
                                                                },
                                                                labels: {
                                                                  style: {
                                                                    colors: '#FEB019',
                                                                  },
                                                                },
                                                                title: {
                                                                  text: "Revenue (million)",
                                                                  style: {
                                                                    color: '#FEB019',
                                                                  }
                                                                }
                                                              },
                                                            ],
                                                            tooltip: {
                                                              fixed: {
                                                                enabled: true,
                                                                position: 'topLeft', // topRight, topLeft, bottomRight, bottomLeft
                                                                offsetY: 30,
                                                                offsetX: 60
                                                              },
                                                            },
                                                            legend: {
                                                              horizontalAlign: 'left',
                                                              offsetX: 40
                                                            }
                                                            };

                                                            var chart = new ApexCharts(document.querySelector("#statementChart"), options);
                                                            chart.render();
                                                        </script>
                                                  </div>
                                                    <div class="tab-pane fade" id="v-radar" role="tabpanel" aria-labelledby="v-radar-tab">
                                                      <div id="radar"></div>
                                                        <script>
                                                            var options = {
                                                                  series: [{
                                                                  name: 'Net Income (Loss)',
                                                                  data: [{% for report in statements %} {{report.net_profit_loss|div:1000000}}, {% endfor %}],
                                                                }, {
                                                                  name: 'Operating Cash Flow',
                                                                  data: [{% for report in statements %} {{report.operating_cash_flow|div:1000000}}, {% endfor %}],
                                                                }, {
                                                                  name: 'Revenue',
                                                                  data: [{% for report in statements %} {{report.total_operating_revenue|div:1000000}}, {% endfor %}],
                                                                }],
                                                                  chart: {
                                                                  height: 350,
                                                                  type: 'radar',
                                                                  dropShadow: {
                                                                    enabled: true,
                                                                    blur: 1,
                                                                    left: 1,
                                                                    top: 1
                                                                  }
                                                                },
                                                                title: {
                                                                  text: 'Radar Chart - Financial Statement Summary'
                                                                },
                                                                stroke: {
                                                                  width: 2
                                                                },
                                                                fill: {
                                                                  opacity: 0.1
                                                                },
                                                                markers: {
                                                                  size: 0
                                                                },
                                                                xaxis: {
                                                                  categories: [{% for report in statements %} {{report.file.year|date:"Y"}}, {% endfor %}]
                                                                }
                                                                };

                                                                var chart = new ApexCharts(document.querySelector("#radar"), options);
                                                                chart.render();
                                                        </script>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                      </div>
                                        <div class="tab-pane fade pt-3" id="technical" role="tabpanel" aria-labelledby="technical-tab">

                                            <div class="row">
                                              <div class="col-3">
                                                <div class="nav flex-column nav-pills" id="v-technical" role="tablist" aria-orientation="vertical">
                                                  <button class="nav-link active" id="v-ma-tab" data-toggle="pill" data-target="#v-ma" type="button" role="tab" aria-controls="v-ma" aria-selected="true">Moving Averages (Days)</button>
                                                    <br>
                                                  <button class="nav-link" id="v-tech-tab" data-toggle="pill" data-target="#v-tech" type="button" role="tab" aria-controls="v-tech" aria-selected="false">Technical Indicators (Days)</button>
                                                </div>
                                              </div>
                                              <div class="col-9">
                                                <div class="tab-content" id="v-technicalContent">
                                                  <div class="tab-pane fade show active" id="v-ma" role="tabpanel" aria-labelledby="v-ma-tab">
                                                      <table class="table table-striped table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Period (Days)</th>
                                                                <th>Simple</th>
                                                                <th>Action</th>
                                                            </tr>
                                                        </thead>
                                                          <tbody>
                                                            <tr>
                                                                <th>5</th>
                                                                <td>{{ma5.price__avg|floatformat:2}}</td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>10</th>
                                                                <td>{{ma5.price__avg|floatformat:2}}</td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>20</th>
                                                                <td>{{ma5.price__avg|floatformat:2}}</td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>50</th>
                                                                <td>{{ma50.price__avg|floatformat:2}}</td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>100</th>
                                                                <td>{{ma100.price__avg|floatformat:2}}</td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                      </table>
                                                  </div>
                                                  <div class="tab-pane fade" id="v-tech" role="tabpanel" aria-labelledby="v-tech-tab">
                                                      <table class="table table-striped table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Name</th>
                                                                <th>Value</th>
                                                                <th>Action</th>
                                                            </tr>
                                                        </thead>
                                                          <tbody>
                                                            <tr>
                                                                <th>RSI(14)</th>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>MACD(12,26)</th>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>ATR(14)</th>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>CCI(14)</th>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                          <tr>
                                                                <th>Highs/Lows(14)</th>
                                                                <td>{{high_14.price__max|floatformat:2}}/{{low_14.price__min|floatformat:2}}</td>
                                                                <td></td>
                                                            </tr>
                                                        </tbody>
                                                      </table>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                      </div>
                                        <div class="tab-pane fade pt-3" id="analysis" role="tabpanel" aria-labelledby="analysis-tab">
                                           <div class="card-body">
                                                <div class="row pb-2">
                                                    {% for opinion in analysis %}
                                                    <div class="col-lg-6 mb-12">
                                                        <div class="card shadow">
                                                            <div class="card-body">
                                                                <div class="row no-gutters align-items-center">
                                                                    <div class="col mr-2">
                                                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                                            {{ opinion.author}} </div>
                                                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{ new.title}}</div>
                                                                        <p>{{ opinion.opinion|truncatewords:20|linebreaks }}</p>
                                                                        <a href="{{ opinion.get_absolute_url }}" class="btn btn-primary">Read More</a>
                                                                        <p><i class="fas fa-calendar-day"></i> {{ opinion.date|naturaltime }} </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% empty %}
                                                        <p>No Analysis Available</p>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                      </div>
                                      <div class="tab-pane fade pt-3" id="ownership" role="tabpanel" aria-labelledby="ownership-tab">
                                          <p><strong></strong></p>
                                          <div class="table-responsive">
                                              {% if ownership %}
                                              <h5>20 Largest Shareholders</h5>
                                            <table class="table table-bordered table-hover table-striped" width="40%" cellspacing="0">
                                                <thead>
                                                    <tr>
                                                        <th>Shareholders</th>
                                                        <th>Number of Shares</th>
                                                        <th>Percentage Holding (%)</th>
                                                    </tr>
                                                </thead>
                                                <tfoot>
                                                    <tr>
                                                        <th>Total</th>
                                                        <th>{% for detail in share %} {{ detail.issued_shares|intcomma }}{% endfor %}</th>
                                                        <th>100 (%)</th>
                                                    </tr>
                                                </tfoot>
                                                <tbody>
                                                {% for shareholder in ownership %}
                                                    <tr>
                                                        <td>{{ shareholder.shareholder_name }}</td>
                                                        <td>{{ shareholder.shares_owned|intcomma }}</td>
                                                        <td>{{ shareholder.percentage_holding }}</td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                            {% else %}
                                                No Ownership Details Added Yet
                                            {% endif %}
                                        </div>
                                        </div>
                                        <div class="tab-pane fade pt-3" id="split" role="tabpanel" aria-labelledby="split-tab">
                                            <div class="row">
                                              <div class="col-3">
                                                <div class="nav flex-column nav-pills" id="v-splits" role="tablist" aria-orientation="vertical">
                                                  <button class="nav-link active" id="v-dividend-tab" data-toggle="pill" data-target="#v-dividend" type="button" role="tab" aria-controls="v-dividend" aria-selected="true">Dividend</button>
                                                    <br>
                                                  <button class="nav-link" id="v-split-tab" data-toggle="pill" data-target="#v-split" type="button" role="tab" aria-controls="v-split" aria-selected="false">Share Splits</button>
                                                </div>
                                              </div>
                                              <div class="col-9">
                                                <div class="tab-content" id="v-splitsContent">
                                                  <div class="tab-pane fade show active" id="v-dividend" role="tabpanel" aria-labelledby="v-dividend-tab">
                                                      <table class="table table-bordered table-striped table-hover">
                                                          <thead>
                                                            <tr>
                                                                <th>Financial Year</th>
                                                                <th>Div Amount</th>
                                                                <th>Payment Date</th>
                                                            </tr>
                                                          </thead>
                                                          <tbody>
                                                             {% for dividend in dividends %}
                                                                <tr>
                                                                    <td>{{dividend.financial_year}}</td>
                                                                    <td>{{dividend.final_dividend}}</td>
                                                                    <td>{{dividend.payment_date}}</td>
                                                                </tr>
                                                             {% empty %}
                                                                <p>{{ company.company_id }} has never paid dividend</p>
                                                             {% endfor %}
                                                          </tbody>
                                                      </table>
                                                  </div>
                                                  <div class="tab-pane fade" id="v-split" role="tabpanel" aria-labelledby="v-split-tab">
                                                      <table class="table table-bordered table-striped table-hover">
                                                          {% if split%}
                                                          <thead>
                                                            <tr>
                                                                <th>Financial Year</th>
                                                                <th>Div Amount</th>
                                                                <th>Payment Date</th>
                                                            </tr>
                                                          </thead>
                                                          <tbody>

                                                             {% for split in share_splits %}
                                                                <tr>
                                                                    <td>{{split}}</td>
                                                                    <td>{{dividend.final_dividend}}</td>
                                                                    <td>{{dividend.payment_date}}</td>
                                                                </tr>
                                                            {% endfor %}
                                                          {% else %}
                                                                <p class="mt-4">{{ company.company_id }} has no share spilts</p>
                                                          </tbody>
                                                          {% endif %}
                                                      </table>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>

                            <!-- Basic Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Financial Statements</h6>
                                </div>
                                <div class="card-body text text-center">
                                    <div class="row">
                                              <div class="col-3">
                                                <div class="nav flex-column nav-pills" id="v-statements" role="tablist" aria-orientation="vertical">
                                                  <button class="nav-link active" id="v-qtr-tab" data-toggle="pill" data-target="#v-qtr" type="button" role="tab" aria-controls="v-qtr" aria-selected="true">1 Qtr</button>
                                                    <br>
                                                  <button class="nav-link" id="v-half-tab" data-toggle="pill" data-target="#v-half" type="button" role="tab" aria-controls="v-half" aria-selected="false">Half Year</button>
                                                    <br>
                                                  <button class="nav-link" id="v-nine-tab" data-toggle="pill" data-target="#v-nine" type="button" role="tab" aria-controls="v-nine" aria-selected="false">Nine Months</button>
                                                    <br>
                                                  <button class="nav-link" id="v-full-tab" data-toggle="pill" data-target="#v-full" type="button" role="tab" aria-controls="v-full" aria-selected="false">Full Year</button>
                                                </div>
                                              </div>
                                              <div class="col-9">
                                                <div class="tab-content" id="v-statementsContent">
                                                    <p>Click to download</p>
                                                  <div class="tab-pane fade show active" id="v-qtr" role="tabpanel" aria-labelledby="v-qtr-tab">
                                                      <div class="row">
                                                          {% for report in reports_qtr %}
                                                            <div class="col-lg-3 mb-2">
                                                                <div class="card shadow">
                                                                    <div class="card-body text-center">
                                                                        <a href="{{report.file.url}}">{{report.year}}</a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                      {% endfor %}
                                                      </div>
                                                  </div>
                                                  <div class="tab-pane fade" id="v-half" role="tabpanel" aria-labelledby="v-half-tab">
                                                        <div class="row">
                                                            {% for report in reports_half %}
                                                                <div class="col-lg-3 mb-2">
                                                                    <div class="card shadow">
                                                                        <div class="card-body text-center">
                                                                            <a href="{{report.file.url}}">{{report.year}}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                          {% endfor %}
                                                        </div>
                                                  </div>
                                                    <div class="tab-pane fade" id="v-nine" role="tabpanel" aria-labelledby="v-nine-tab">
                                                        <div class="row">
                                                            {% for report in reports_nine %}
                                                                <div class="col-lg-3 mb-2">
                                                                    <div class="card shadow">
                                                                        <div class="card-body text-center">
                                                                            <a href="{{report.file.url}}">{{report.year}}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                          {% endfor %}
                                                        </div>
                                                  </div>

                                                    <div class="tab-pane fade" id="v-full" role="tabpanel" aria-labelledby="v-full-tab">
                                                        <div class="row">
                                                            {% for report in reports_full %}
                                                                <div class="col-lg-3 mb-2">
                                                                    <div class="card shadow">
                                                                        <div class="card-body text-center">
                                                                            <a href="{{report.file.url}}">{{report.year}}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                        {% endfor %}
                                                        </div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                </div>
                            </div>

                            <!-- Default Card Example -->
                            <div class="card mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Revenue Centers</h6>
                                </div>
                                <div class="card-body text text-center">
                                    <ul class="nav nav-tabs" id="myCenters" role="tablist">
                                      <li class="nav-item">
                                        <a class="nav-link active" id="services-tab" data-toggle="tab" href="#services" role="tab" aria-controls="services" aria-selected="false">Services / Products</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="brands-tab" data-toggle="tab" href="#brands" role="tab" aria-controls="brands" aria-selected="false">Brands</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="segments-tab" data-toggle="tab" href="#segments" role="tab" aria-controls="segments" aria-selected="false">Operating Segments</a>
                                      </li>
                                    </ul>
                                    <div class="tab-content" id="myCentersContent">
                                      <div class="tab-pane fade show active pt-3" id="services" role="tabpanel" aria-labelledby="services-tab">
                                        {% for service in products %}
                                            <p title="{{service.detail}}"><strong>{{service}}</strong></p>
                                         {% empty %}
                                            <p>No service/product added yet</p>
                                         {% endfor %}
                                      </div>
                                      <div class="tab-pane fade show pt-3" id="brands" role="tabpanel" aria-labelledby="brands-tab">
                                        <p>Brands Here</p>
                                      </div>
                                        <div class="tab-pane fade show pt-3" id="segments" role="tabpanel" aria-labelledby="segments-tab">
                                        <p>Segments Here</p>
                                      </div>

                                    </div>
                                </div>
                            </div>

                            {% if company.industry.first.title == 'Banking' %}
                            <!-- Default Card Example -->
                            <div class="card mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Bank Health <i class='bx bxs-lock'></i></h6>
                                </div>
                                <div class="card-body text text-center">
                                    <ul class="nav nav-tabs" id="myHealth" role="tablist">
                                      <li class="nav-item">
                                        <a class="nav-link active" id="deposits-tab" data-toggle="tab" href="#deposits" role="tab" aria-controls="deposits" aria-selected="false">Deposits</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="advances-tab" data-toggle="tab" href="#advances" role="tab" aria-controls="advances" aria-selected="false">Net Advances</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="impairment-tab" data-toggle="tab" href="#impairment" role="tab" aria-controls="impairment" aria-selected="false">Net Impairment</a>
                                      </li>
                                    </ul>
                                    <div class="tab-content" id="myHealthContent">
                                      <div class="tab-pane fade show active pt-3" id="deposits" role="tabpanel" aria-labelledby="deposits-tab">
                                        <p>Deposits Here</p>
                                      </div>
                                      <div class="tab-pane fade show pt-3" id="advances" role="tabpanel" aria-labelledby="advances-tab">
                                        <p>Net Advances Here</p>
                                      </div>
                                        <div class="tab-pane fade show pt-3" id="impairment" role="tabpanel" aria-labelledby="impairment-tab">
                                        <p>Net Impairment Here</p>
                                      </div>

                                    </div>
                                </div>
                            </div>

                            {% endif %}

                            <!-- Basic Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Others</h6>
                                </div>
                                <div class="card-body">
                                </div>
                            </div>

                             <!-- Basic Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Subsidiaries</h6>
                                </div>
                                <div class="card-body">
                                    {% for subsidiary in subsidiaries  %}
                                        <p>{{ subsidiary.subsidiary_name }} <strong>({{ subsidiary.ownership_pct }} %)</strong></p>
                                    {% empty %}
                                        No subsidiary added yet
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Basic Card Example -->
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Key People</h6>
                                </div>
                                <div class="card-body">
                                    {% for people in key_people %}
                                        <p title="{{people.description}}"><strong>{{ people.position }}</strong> {{ people.name }}</p>
                                    {% empty %}
                                        No person listed here
                                    {% endfor %}
                                </div>
                            </div>


                            {% if price_year_start.price >= 0 %}

                            <!-- Default Card Example -->
                            <div class="card mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Pro  <i class='bx bxs-lock'></i></h6>
                                </div>
                                <div class="card-body text text-center">
                                    <ul class="nav nav-tabs" id="myPro" role="tablist">
                                      <li class="nav-item">
                                        <a class="nav-link active" id="fairvalue-tab" data-toggle="tab" href="#fairvalue" role="tab" aria-controls="contact" aria-selected="false">Fair value</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="score-tab" data-toggle="tab" href="#score" role="tab" aria-controls="score" aria-selected="false">Company Score</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="health-tab" data-toggle="tab" href="#health" role="tab" aria-controls="health" aria-selected="false">Financial Health</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="Advisory-tab" data-toggle="tab" href="#Advisory" role="tab" aria-controls="Advisory" aria-selected="false">Stock Advisory</a>
                                      </li>
                                    </ul>
                                    <div class="tab-content" id="myProContent">
                                      <div class="tab-pane fade show active pt-3" id="fairvalue" role="tabpanel" aria-labelledby="fairvalue-tab">
                                        <p>Company Fair Value Here</p>
                                      </div>
                                      <div class="tab-pane fade show pt-3" id="score" role="tabpanel" aria-labelledby="score-tab">
                                        <p>Company Score Here</p>
                                      </div>
                                        <div class="tab-pane fade show pt-3" id="health" role="tabpanel" aria-labelledby="health-tab">
                                        <p>Company Health Here</p>
                                      </div>
                                        <div class="tab-pane fade show pt-3" id="Advisory" role="tabpanel" aria-labelledby="Advisory-tab">
                                        <p>Company Advisory Here</p>
                                      </div>

                                    </div>
                                </div>
                            </div>

                            {% endif %}

                            <!-- Default Card Example -->
                            <div class="card mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Ratings & Forum</h6>
                                </div>
                                <div class="card-body text text-center">
                                    <ul class="nav nav-tabs" id="myForum" role="tablist">
                                      <li class="nav-item">
                                        <a class="nav-link active" id="rating-tab" data-toggle="tab" href="#rating" role="tab" aria-controls="rating" aria-selected="false">User Ratings</a>
                                      </li>
                                        <li class="nav-item">
                                        <a class="nav-link" id="forum-tab" data-toggle="tab" href="#forum" role="tab" aria-controls="forum" aria-selected="false">Forum</a>
                                      </li>
                                    </ul>
                                    <div class="tab-content" id="myForumContent">
                                      <div class="tab-pane fade show active pt-3" id="rating" role="tabpanel" aria-labelledby="rating-tab">
                                          {% if not reviews %}
                                                <h3>Be the first one to write a review.</h3>
                                            {% else %}
                                                <span>Overall Rating: </span>
                                                <span>
                                                    {% if company_rating == 0 %}
                                                        <i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                    {% endif%}
                                                    {% if company_rating == 1 %}
                                                        <i class='bx bxs-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                    {% endif%}
                                                    {% if company_rating == 2 %}
                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                    {% endif%}
                                                    {% if company_rating == 3 %}
                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                    {% endif%}
                                                    {% if company_rating == 4 %}
                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bx-star'></i>
                                                    {% endif%}
                                                    {% if company_rating == 5 %}
                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i>
                                                    {% endif%}
                                                </span>
                                                <br>
                                                <hr>
                                                <h3>Review Comments</h3>
                                                <ol>
                                                {% for review in reviews %}
                                                    <li class="ui list">
                                                            <span>Review comment: </span> <span>{{ review.content }}</span>
                                                            <br>
                                                            <span>Created on: </span><span>{{ review.date_created }}</span>
                                                            <br>
                                                            <span>Modified on: </span><span>{{ review.date_edited }}</span>
                                                            <br>
                                                            <span>Rating: </span><span>{% if review.rating == 0 %}
                                                                    <i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                                    {% endif%}
                                                                    {% if review.rating == 1 %}
                                                                        <i class='bx bxs-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                                    {% endif%}
                                                                    {% if review.rating == 2 %}
                                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                                    {% endif%}
                                                                    {% if review.rating == 3 %}
                                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bx-star'></i><i class='bx bx-star'></i>
                                                                    {% endif%}
                                                                    {% if review.rating == 4 %}
                                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bx-star'></i>
                                                                    {% endif%}
                                                                    {% if review.rating == 5 %}
                                                                        <i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i><i class='bx bxs-star'></i>
                                                                    {% endif%}
                                                            </span>
                                                            <br>
                                                            <span>Creator: </span><span>{{ review.creator.username }}</span>
                                                            <br>
                                                            <a href="{% url 'review_edit' company.pk review.pk %}"><i class='bx bxs-edit-alt' ></i> Edit Review</a>
                                                    </li>
                                                {% endfor %}
                                                </ol>
                                        {% endif %}
                                        <a class="ui primary button" href="{% url 'review_create' company.pk %}" class="btn btn-primary"><i class='bx bxs-add-to-queue' ></i> Add Review</a>
                                      </div>
                                      <div class="tab-pane fade show pt-3" id="forum" role="tabpanel" aria-labelledby="forum-tab">
                                        <p>Forum Here</p>
                                      </div>

                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="col-lg-4">

                            <!-- Dropdown Card Example -->
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Basic Info.</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="basicInfo"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="basicInfo">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <p><strong>Industry:</strong> {% for industry in company.industry.all %}<a href="{{ industry.get_absolute_url }}">{{ industry }}</a>{% endfor %}</p>
                                    <p><strong>Country:</strong> <a href="{% url 'country' company.country.slug %}">{{ company.country }}</a></p>
                                    <p><strong>Auditors:</strong> {% for auditor in auditor %}<a href="{{ auditor.get_absolute_url }}">{{ auditor.name }}</a>{% empty %}No Auditor{% endfor %}</p>
                                    <p><strong>Secretary:</strong> {% for secretary in secretaries %}{{ secretary.name }}{% empty %}No Secretary{% endfor %}</p>
                                    <p><strong>Registrar:</strong> {% for registrar in registrars %}{{ registrar.name }}{% empty %}No Registrar{% endfor %}</p>
                                    <p><strong>Registered Office:</strong> {{ company.registered_office }}</p>
                                    <p><strong>Incorporate Date:</strong> {{ company.incorporated_date }}</p>
                                    <p><strong>Employees:</strong> {{ company.employees }}</p>
                                </div>
                            </div>

                            {% if price_year_start.price >= 0 %}
                            <!-- Dropdown Card Example -->
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Stock Price Summary</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-7">
                                            <p><strong>Previous Close: </strong>{{ company.country.currency_code }} {{ previous_close.price }}</p>

                                            <p><strong>Volume:</strong> {{ price.volume }}</p>
                                            <p><strong>Traded Value:</strong> {{ company.country.currency_code }} {{ price.volume|mul:price.price }}</p>
                                            <p><strong>Year Range:</strong> {{ company.country.currency_code }} {{ high_52.price__max }} - {{ company.country.currency_code }} {{ low_52.price__min }}</p>
                                            <p><strong>Market Cap:</strong> {{ company.country.currency_code }} {% for detail in share %}{{ detail.issued_shares|mul:price.price|div:1000000|floatformat:2|intcomma }}{% endfor %} million</p
                                            <p><strong>Shares Outstanding:</strong> {% for detail in share %} {{ detail.issued_shares|intcomma }}{% endfor %}</p>
                                        </div>
                                        <div class="col-5">

                                            <p><strong>Open:</strong> {{ company.country.currency_code }} {{ price.price }}</p>
                                            <p><strong>1-Yr Change:</strong>
                                                {% if price.price|sub:price_year_start.price >= 0 %}
                                                    <span class="change-up">{{ company.country.currency_code }} {{ price.price|sub:price_year_start.price|floatformat:2}}</span>
                                                {% else %}
                                                    <span class="change-down">{{ company.country.currency_code }} {{ price.price|sub:price_year_start.price|floatformat:2}}</span>
                                                {% endif %}
                                            </p>
                                            <p><strong>YTD(%):</strong>
                                                {% if price.price|sub:price_year_start.price|mul:100|div:price_year_start.price >= 0 %}
                                                    {% if price.price|sub:price_year_start.price|mul:100|div:price_year_start.price > 0 %}
                                                        <span class="change-up">{{ price.price|sub:price_year_start.price|mul:100|div:price_year_start.price|floatformat:2}}</span>
                                                    {% else %}
                                                        <span class="change-none">{{ price.price|sub:price_year_start.price|mul:100|div:price_year_start.price|floatformat:2}}</span>
                                                    {% endif %}
                                                {% else %}
                                                    <span class="change-down">{{ price.price|sub:price_year_start.price|mul:100|div:price_year_start.price|floatformat:2}}</span>
                                                {% endif %}
                                            </p>
                                            <p><strong>EPS:</strong>
                                                {% if statement.net_profit_loss|div:detail.issued_shares >= 0 %}
                                                    {% for detail in share %}
                                                        <span class="change-up">{{ statement.net_profit_loss|div:detail.issued_shares|floatformat:4 }}</span>
                                                    {% endfor %}
                                                {% else %}
                                                    {% for detail in share %}
                                                        <span class="change-down">{{ statement.net_profit_loss|div:detail.issued_shares|floatformat:4 }}</span>
                                                    {% endfor %}
                                                {% endif %}
                                            </p>
                                            <p><strong>Beta: {{corr|div:indices.value__variance|floatformat:2}}</strong>
                                            <p><strong>Div (Yield)(%): {{ dividend_latest.final_dividend|div:price.price|mul:100|floatformat:2 }}</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Stock Price Performance</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <table class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Period</th>
                                                <th>Performance</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1 Month</td>
                                                <td id="month-1">{% for value in sp %}
                                                        {{value.price|sub:value.prev_mothn_val }} (<span class="value">{{value.price|sub:value.prev_mothn_val|div:value.prev_mothn_val|mul:100|floatformat:2 }}%</span>)
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>YTD</td>
                                                <td>{% for value in sp %}
                                                        {{value.price|sub:value.ytd_val }} (<span class="value">{{value.price|sub:value.ytd_val|div:value.ytd_val|mul:100|floatformat:2 }}%</span>)
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>1 Year</td>
                                                <td>{% for value in sp %}
                                                        {{value.price|sub:value.one_yr_val }} (<span class="value">{{value.price|sub:value.one_yr_val|div:value.one_yr_val|mul:100|floatformat:2 }}%</span>)
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>3 Years</td>
                                                <td>{% for value in sp %}
                                                        {{value.price|sub:value.three_yr_val }} (<span class="value">{{value.price|sub:value.three_yr_val|div:value.three_yr_val|mul:100|floatformat:2 }}%</span>)
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>5 Years</td>
                                                <td>{% for value in sp %}
                                                        {{value.price|sub:value.five_yr_val }} (<span class="value">{{value.price|sub:value.five_yr_val|div:value.five_yr_val|mul:100|floatformat:2 }}%</span>)
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Dropdown Card Example -->
                            <!-- Dropdown Card Example -->
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Latest Press Releases</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="Releases"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="Releases">
                                            <div class="dropdown-header">Press Releases:</div>
                                            <a class="dropdown-item" href="{% url 'company_press_details' company.id %}">All Press Releases</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="text">
                                        {% for press in release %}
                                            <p><img src="{% static 'img/pdf.png' %}" alt="" height="30"><a href="{{ press.file.url }}" target="_blank"> {{ press.title }} <small>[{{ press.date|date:"d/m/Y" }}]</small></a><i class="fas fa-download"></i></p>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <!-- Collapsable Card Example -->
                            <div class="card shadow mb-4">
                                <!-- Card Header - Accordion -->
                                <a href="#collapse1" class="d-block card-header py-3" data-toggle="collapse"
                                    role="button" aria-expanded="true" aria-controls="collapseCardExample">
                                    <h6 class="m-0 font-weight-bold text-primary">Stock Price History</h6>
                                </a>
                                <!-- Card Content - Collapse -->
                                <div class="collapse show" id="collapse1">
<!--                                    <div class="card-body">-->
<!--                                        <table>-->
<!--                                            {% for price in share_price %}-->
<!--                                                <li>{{ price.date }} - {{ price.price }}</li>-->
<!--                                            {% endfor %}-->
<!--                                        </table>-->
<!--                                    </div>-->

                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-striped table-hover" id="dataTable" width="80%" cellspacing="0">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Close</th>
                                                    <th>Volume</th>
                                                    <th>Traded Value</th>
                                                </tr>
                                            </thead>
<!--                                            <tfoot>-->
<!--                                                <tr>-->
<!--                                                    <th>Date</th>-->
<!--                                                    <th>Close</th>-->
<!--                                                    <th>Volume</th>-->
<!--                                                </tr>-->
<!--                                            </tfoot>-->
                                            <tbody>
                                            {% for price in share_price %}
                                                <tr>
                                                    <td>{{ price.date|date:"Y/m/d" }}</td>
                                                    <td>{{ price.price }}</td>
                                                    <td>{{ price.volume }}</td>
                                                    <td>{{ price.volume|mul:price.price }}</td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="card shadow mb-4">
                                <!-- Card Header - Accordion -->
                                <a href="#collapse2" class="d-block card-header py-3" data-toggle="collapse"
                                    role="button" aria-expanded="true" aria-controls="collapseCardExample">
                                    <h6 class="m-0 font-weight-bold text-primary">Share Listing Details</h6>
                                </a>
                                <!-- Card Content - Collapse -->
                                <div class="collapse show" id="collapse2">
                                    <div class="card-body">
                                        {% for detail in share %}
                                        <p><strong>Issued Shares:</strong> {{ detail.issued_shares|intcomma }}</p>
                                        {% if detail.stated_capital%} <p><strong>Stated Capital:</strong> {{ detail.stated_capital|intcomma }}</p> {% endif %}
                                        {% if detail.listed_date%} <p><strong>Listed Date:</strong> {{ detail.listed_date }}</p> {% endif %}
                                        {% if detail.financial_period_ends%} <p><strong>Financial Year Ends:</strong> {{ detail.financial_period_ends }}</p> {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <div class="card shadow mb-4">
                                <!-- Card Header - Accordion -->
                                <a href="#collapse3" class="d-block card-header py-3" data-toggle="collapse"
                                    role="button" aria-expanded="true" aria-controls="collapseCardExample">
                                    <h6 class="m-0 font-weight-bold text-primary">Latest Dividend</h6>
                                </a>
                                <!-- Card Content - Collapse -->
                                <div class="collapse show" id="collapse3">
                                    <div class="card-body">
                                        {% for dividend in current_dividend %}
                                            <p><strong>Final Dividend:</strong> GHS {{ dividend.final_dividend|floatformat:2 }} </p>
                                            <p><strong>File:</strong><a href="{{ dividend.file.url }}" target="_blank"> Dividend File</a> <i class="fas fa-download"></i></p>
                                            <p><strong>Qualifying Date:</strong> {{ dividend.qualifying_date }} </p>
                                            <p><strong>Register Closure:</strong> {{ dividend.register_closure }}</p>
                                            <p><strong>Ex Dividend Date:</strong> {{ dividend.ex_dividend_date }}</p>
                                            <p><strong>Payment Date:</strong> {{ dividend.payment_date }}</p>
                                            <p><strong>AGM Date:</strong> {{ dividend.agm }}</p>

<!--                                            <h6></h6><a href="{% url 'company_dividend_details' company.id %}"></a></h6>-->
                                        {% empty %}
                                            <p><strong>{{ company.company_id }} is yet to pay dividend</strong></p>
                                        {% endfor %}



                                    </div>
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Listing Information</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    {% for ipo in ipos %}
                                        <p><strong>Prospectus:</strong><a href="{{ ipo.prospectus.url }}" target="_blank"> Prospectus  </a><i class="fas fa-download"></i></p>
                                        <p><strong>First Trading Date:</strong> {{ ipo.ipo_date }} </p>
                                        <p><strong>IPO Share Price:</strong> GHS {{ ipo.ipo_price }}</p>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Similar Companies</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    {% for company in similar_company %}
                                        <p><strong><a href="{{ company.get_absolute_url }}" title="{{company.summary}}">{{company.name}}</a></strong>
                                    {% empty %}
                                        <p><strong>No Similar Company</strong></p>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Indices</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    {% for index in country_indices %}
                                        <p><strong><a href="{% url 'index_detail' index.id %}">{{index.name}}</a></strong>
                                    {% empty %}
                                        <p><strong>No Indices</strong></p>
                                    {% endfor %}
                                </div>
                            </div>

                            {% endif %}

                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Contact Information</h6>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <p><strong>Telephone:</strong> {{ company.telephone }}</p>
                                    <p><strong>Email:</strong> {{ company.email }}</p>
                                    <p><strong>Website:</strong> <a href="{{ company.website }}" target="_blank">{{ company.website }}</a></p>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>
                <!-- /.container-fluid -->

{% endblock %}
{% block script %}
<!-- Page level plugins -->
    <script src="{% static 'vendor/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'vendor/datatables/dataTables.bootstrap4.min.js' %}"></script>

    <!-- Page level custom scripts -->
    <script src="{% static 'js/demo/datatables-demo.js' %}"></script>
{% endblock %}